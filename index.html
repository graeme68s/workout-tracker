<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout Tracker">
    <meta name="theme-color" content="#2563EB">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Workout Tracker</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%); 
            min-height: 100vh;
            padding-bottom: 20px;
        }
        .container { 
            max-width: 100%; 
            margin: 0 auto; 
            background: white; 
        }
        .header { 
            background: linear-gradient(135deg, #2563EB 0%, #4F46E5 100%); 
            color: white; 
            padding: 20px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 8px; 
        }
        .header-title h1 { 
            font-size: 22px; 
            font-weight: bold; 
        }
        .header-subtitle { 
            color: #DBEAFE; 
            font-size: 13px; 
            margin-top: 4px; 
        }
        .buttons { 
            display: flex; 
            gap: 8px; 
        }
        .btn { 
            background: white; 
            color: #2563EB; 
            padding: 10px 14px; 
            border-radius: 8px; 
            border: none; 
            font-weight: 600; 
            cursor: pointer; 
            font-size: 14px;
            touch-action: manipulation;
        }
        .btn:active { 
            opacity: 0.7;
            transform: scale(0.95);
        }
        .storage-info {
            background: #DBEAFE;
            color: #1E40AF;
            padding: 8px 16px;
            font-size: 12px;
            text-align: center;
        }
        .days-container { 
            background: #F9FAFB; 
            padding: 12px 16px;
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
        }
        .days { 
            display: inline-flex;
            gap: 8px;
        }
        .day-btn { 
            padding: 14px 16px; 
            border-radius: 12px; 
            border: none; 
            font-weight: 600; 
            cursor: pointer; 
            text-align: center; 
            min-width: 70px;
            transition: all 0.2s;
            touch-action: manipulation;
            flex-shrink: 0;
        }
        .day-btn.active { 
            background: #2563EB; 
            color: white; 
            transform: scale(1.05); 
        }
        .day-btn.rest { 
            background: #FED7AA; 
            color: #9A3412; 
        }
        .day-btn.completed { 
            background: #BBF7D0; 
            color: #166534; 
        }
        .day-btn.empty { 
            background: white; 
            color: #374151; 
        }
        .day-btn:active { 
            opacity: 0.8; 
        }
        .day-name { 
            font-size: 14px; 
        }
        .day-status { 
            font-size: 11px; 
            margin-top: 4px; 
        }
        .content { 
            padding: 20px 16px; 
        }
        .content-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .content-title { 
            font-size: 22px; 
            font-weight: bold; 
            color: #1F2937; 
        }
        .rest-toggle { 
            padding: 10px 16px; 
            border-radius: 8px; 
            border: none; 
            font-weight: 600; 
            cursor: pointer;
            font-size: 14px;
            touch-action: manipulation;
        }
        .rest-toggle.active { 
            background: #F97316; 
            color: white; 
        }
        .rest-toggle.inactive { 
            background: #E5E7EB; 
            color: #374151; 
        }
        .rest-toggle:active {
            opacity: 0.8;
        }
        .rest-day-display { 
            background: #FFF7ED; 
            border: 2px solid #FED7AA; 
            border-radius: 12px; 
            padding: 40px 20px; 
            text-align: center; 
        }
        .rest-emoji { 
            font-size: 64px; 
            margin-bottom: 16px; 
        }
        .rest-title { 
            font-size: 20px; 
            font-weight: bold; 
            color: #9A3412; 
            margin-bottom: 8px; 
        }
        .rest-text { 
            color: #C2410C; 
            font-size: 15px;
        }
        .form-group { 
            margin-bottom: 20px; 
        }
        .label { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 14px; 
            font-weight: 600; 
            color: #374151; 
            margin-bottom: 8px; 
        }
        textarea { 
            width: 100%; 
            padding: 14px; 
            border: 2px solid #E5E7EB; 
            border-radius: 10px; 
            font-family: inherit; 
            font-size: 16px; 
            resize: vertical;
            -webkit-appearance: none;
        }
        textarea:focus { 
            outline: none; 
            border-color: #2563EB; 
        }
        .summary { 
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%); 
            border-radius: 12px; 
            padding: 20px; 
            margin-top: 30px; 
        }
        .summary-title { 
            font-size: 18px; 
            font-weight: bold; 
            color: #1F2937; 
            margin-bottom: 16px; 
        }
        .summary-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px; 
        }
        .summary-card { 
            background: white; 
            border-radius: 10px; 
            padding: 16px 12px; 
            text-align: center; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .summary-value { 
            font-size: 28px; 
            font-weight: bold; 
        }
        .summary-value.green { 
            color: #16A34A; 
        }
        .summary-value.orange { 
            color: #EA580C; 
        }
        .summary-value.blue { 
            color: #2563EB; 
        }
        .summary-label { 
            font-size: 11px; 
            color: #6B7280; 
            margin-top: 4px; 
        }
        input[type="file"] { 
            display: none; 
        }
        .install-prompt {
            background: #10B981;
            color: white;
            padding: 12px 16px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }
        .install-prompt:active {
            background: #059669;
        }
        @media (max-width: 400px) {
            .header-title h1 {
                font-size: 18px;
            }
            .header-subtitle {
                font-size: 12px;
            }
            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            .content-title {
                font-size: 20px;
            }
            .summary-value {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="install-prompt" id="installPrompt" onclick="installApp()">
        üì± Tap to Install App
    </div>

    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <div>
                        <h1>üí™ Workout Tracker</h1>
                        <div class="header-subtitle">Track your fitness journey</div>
                    </div>
                </div>
                <div class="buttons">
                    <button class="btn" onclick="saveData()">üíæ</button>
                    <label class="btn" style="margin: 0; cursor: pointer;">
                        üìÇ
                        <input type="file" accept=".json" onchange="loadData(event)">
                    </label>
                </div>
            </div>
        </div>

        <div class="storage-info">
            üíæ Data stored locally on your device
        </div>

        <div class="days-container">
            <div class="days" id="daysContainer"></div>
        </div>

        <div class="content">
            <div class="content-header">
                <div class="content-title" id="currentDayTitle">Monday</div>
                <button class="rest-toggle inactive" id="restToggle" onclick="toggleRestDay()">
                    Rest Day
                </button>
            </div>

            <div id="workoutForm">
                <div class="form-group">
                    <div class="label">
                        üí™ Workout Details
                    </div>
                    <textarea id="workoutInput" rows="5" placeholder="e.g., Chest & Triceps&#10;‚Ä¢ Bench press 4x10&#10;‚Ä¢ Incline DB press 3x12&#10;‚Ä¢ Cable flies 3x15" oninput="updateWorkout()"></textarea>
                </div>

                <div class="form-group">
                    <div class="label">
                        üìù Notes
                    </div>
                    <textarea id="notesInput" rows="4" placeholder="How did you feel? Any PRs?" oninput="updateNotes()"></textarea>
                </div>
            </div>

            <div id="restDayDisplay" style="display: none;">
                <div class="rest-day-display">
                    <div class="rest-emoji">üò¥</div>
                    <div class="rest-title">Rest Day</div>
                    <div class="rest-text">Recovery is just as important!</div>
                </div>
            </div>

            <div class="summary">
                <div class="summary-title">Weekly Summary</div>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-value green" id="workoutsCount">0</div>
                        <div class="summary-label">Workouts</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value orange" id="restCount">0</div>
                        <div class="summary-label">Rest Days</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value blue" id="remainingCount">7</div>
                        <div class="summary-label">Remaining</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }

        // Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        document.getElementById('installPrompt').style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        }

        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        let currentDay = 'Monday';
        let workouts = {};

        days.forEach(day => {
            workouts[day] = { workout: '', notes: '', isRestDay: false };
        });

        function loadFromStorage() {
            const saved = localStorage.getItem('workoutTracker');
            if (saved) {
                try {
                    workouts = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        function saveToStorage() {
            try {
                localStorage.setItem('workoutTracker', JSON.stringify(workouts));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function init() {
            loadFromStorage();
            renderDays();
            renderCurrentDay();
            updateSummary();
        }

        function renderDays() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = days.map(day => {
                const status = getDayStatus(day);
                const classes = ['day-btn', day === currentDay ? 'active' : status];
                return `
                    <button class="${classes.join(' ')}" onclick="selectDay('${day}')">
                        <div class="day-name">${day.slice(0, 3)}</div>
                        ${status === 'rest' ? '<div class="day-status">Rest</div>' : ''}
                        ${status === 'completed' ? '<div class="day-status">‚úì</div>' : ''}
                    </button>
                `;
            }).join('');
        }

        function getDayStatus(day) {
            if (workouts[day].isRestDay) return 'rest';
            if (workouts[day].workout.trim()) return 'completed';
            return 'empty';
        }

        function selectDay(day) {
            currentDay = day;
            renderDays();
            renderCurrentDay();
        }

        function renderCurrentDay() {
            document.getElementById('currentDayTitle').textContent = currentDay;
            const data = workouts[currentDay];
            
            if (data.isRestDay) {
                document.getElementById('workoutForm').style.display = 'none';
                document.getElementById('restDayDisplay').style.display = 'block';
                document.getElementById('restToggle').className = 'rest-toggle active';
                document.getElementById('restToggle').textContent = 'Rest Day ‚úì';
            } else {
                document.getElementById('workoutForm').style.display = 'block';
                document.getElementById('restDayDisplay').style.display = 'none';
                document.getElementById('restToggle').className = 'rest-toggle inactive';
                document.getElementById('restToggle').textContent = 'Rest Day';
                document.getElementById('workoutInput').value = data.workout;
                document.getElementById('notesInput').value = data.notes;
            }
        }

        function toggleRestDay() {
            workouts[currentDay].isRestDay = !workouts[currentDay].isRestDay;
            if (workouts[currentDay].isRestDay) {
                workouts[currentDay].workout = '';
                workouts[currentDay].notes = '';
            }
            renderDays();
            renderCurrentDay();
            updateSummary();
            saveToStorage();
        }

        function updateWorkout() {
            workouts[currentDay].workout = document.getElementById('workoutInput').value;
            renderDays();
            updateSummary();
            saveToStorage();
        }

        function updateNotes() {
            workouts[currentDay].notes = document.getElementById('notesInput').value;
            saveToStorage();
        }

        function updateSummary() {
            const workoutsCount = days.filter(day => workouts[day].workout.trim() && !workouts[day].isRestDay).length;
            const restCount = days.filter(day => workouts[day].isRestDay).length;
            const remainingCount = days.filter(day => !workouts[day].workout.trim() && !workouts[day].isRestDay).length;
            
            document.getElementById('workoutsCount').textContent = workoutsCount;
            document.getElementById('restCount').textContent = restCount;
            document.getElementById('remainingCount').textContent = remainingCount;
        }

        function saveData() {
            const dataStr = JSON.stringify(workouts, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            link.href = url;
            link.download = `workout-${date}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 1000);
        }

        function loadData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        workouts = JSON.parse(e.target.result);
                        renderDays();
                        renderCurrentDay();
                        updateSummary();
                        saveToStorage();
                        alert('Data loaded successfully!');
                    } catch (error) {
                        alert('Error loading file. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            }
        }

        init();
    </script>
</body>
</html>
